<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>力量成長曲線</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>

<body>
    <h2 id="title">力量成長曲線</h2>

    <label for="languageSelect">Language / 語言:</label>
    <select id="languageSelect" onchange="updateChart()">
        <option value="zh">中文</option>
        <option value="en">English</option>
    </select>

    <br><br>

    <label for="unitSelect">單位 / Unit:</label>
    <select id="unitSelect" onchange="updateChart()">
        <option value="kg">公斤 (kg)</option>
        <option value="lb">磅 (lb)</option>
    </select>

    <br><br>

    <label for="genderSelect">選擇性別:</label>
    <select id="genderSelect" onchange="setDefaultWeight(); updateChart()">
        <option value="male">男性</option>
        <option value="female">女性</option>
    </select>

    <br><br>

    <label for="movementSelect">選擇動作:</label>
    <select id="movementSelect" onchange="updateChart()">
        <option value="Press">肩推 (Press)</option>
        <option value="Bench Press">臥推 (Bench Press)</option>
        <option value="Squat">深蹲 (Squat)</option>
        <option value="Deadlift">硬舉 (Deadlift)</option>
        <option value="Power Clean">抓舉 (Power Clean)</option>
    </select>

    <br><br>

    <label for="weightRange">選擇體重:</label>
    <input type="range" id="weightRange" min="40" max="120" value="70" step="1" oninput="updateChart()">
    <span id="weightDisplay">70 kg</span>

    <br><br>

    <label for="xMaxRange">X 軸最大值 (月):</label>
    <input type="range" id="xMaxRange" min="12" max="120" value="60" step="1" oninput="updateChart()">
    <span id="xMaxDisplay">60 月</span>

    <br><br>

    <label for="yMaxRange">Y 軸最大值:</label>
    <input type="range" id="yMaxRange" min="50" max="500" value="200" step="10" oninput="updateChart()">
    <span id="yMaxDisplay">200 kg</span>

    <br><br>

    <div id="chart" style="width:100%;max-width:900px;height:600px;"></div>

    <script>
        let language = 'zh';
        let unit = 'kg';

        const movementParams = {
            "male": {
                "Press": { a: 0.143081, s: -0.006382, t_b: 1.175420, p: -10.000000, q: 0.000139, r: 0.523168 },
                "Bench Press": { a: 0.313917, s: -0.002640, t_b: 0.483858, p: -0.542333, q: 0.008190, r: 0.885181 },
                "Squat": { a: 0.542238, s: -0.004639, t_b: 0.839241, p: 0.094006, q: 1.000000, r: 0.207660 },
                "Deadlift": { a: 0.616152, s: -0.004511, t_b: 0.793862, p: -10.000000, q: 0.000214, r: 0.927825 },
                "Power Clean": { a: 0.272927, s: -0.006954, t_b: 1.241554, p: -0.831159, q: 0.002697, r: 0.608000 }
            },
            "female": {
                "Press": { a: 1.060079656, s: -0.00000479555, t_b: 0.016407532, p: -9.999999936, q: 0.0000283981, r: 0.344401136 },
                "Bench Press": { a: 1.156197656, s: -0.0000694985, t_b: 0.022878292, p: -9.999999992, q: 0.000181857, r: 0.591675884 },
                "Squat": { a: 0.518626596, s: -0.000598282, t_b: 0.193108691, p: -9.999999999, q: 0.000101625, r: 0.53494326 },
                "Deadlift": { a: 1.107697795, s: -0.000438779, t_b: 0.096978515, p: -9.999999985, q: 0.000191939, r: 0.685331933 },
                "Power Clean": { a: 0.372718555, s: -0.000882204, t_b: 0.208095481, p: -9.999999796, q: 0.000073921, r: 0.384703321 }
            }
        };

        function calculateAbsoluteStrength(t, w, params) {
            const ratio = params.a * Math.log((params.s * w + params.t_b) * t + 1) + (params.p * Math.log(params.q * w + 1) + params.r);
            return ratio * w;
        }

        function setDefaultWeight() {
            const gender = document.getElementById('genderSelect').value;
            const weightRange = document.getElementById('weightRange');
            const weightDisplay = document.getElementById('weightDisplay');

            if (gender === 'male') {
                weightRange.value = 70;
                weightDisplay.innerText = '70 kg';
            } else {
                weightRange.value = 55;
                weightDisplay.innerText = '55 kg';
            }
        }

        function updateChart() {
            language = document.getElementById('languageSelect').value;
            unit = document.getElementById('unitSelect').value;

            const gender = document.getElementById('genderSelect').value;
            const movement = document.getElementById('movementSelect').value;
            const params = movementParams[gender][movement];

            const weightSlider = document.getElementById('weightRange');
            let weight = parseInt(weightSlider.value);
            let weightDisplay = document.getElementById('weightDisplay');

            let xMax = parseInt(document.getElementById('xMaxRange').value);
            let yMax = parseInt(document.getElementById('yMaxRange').value);

            if (unit === 'lb') {
                weightDisplay.innerText = (weight * 2.20462).toFixed(0) + ' lb';
            } else {
                weightDisplay.innerText = weight + ' kg';
            }

            document.getElementById('xMaxDisplay').innerText = xMax + (language === 'zh' ? ' 月' : ' months');
            document.getElementById('yMaxDisplay').innerText = yMax + ' ' + unit;

            let xData = [];
            let yData = [];

            for (let t = 0; t <= xMax; t++) {
                let strength = calculateAbsoluteStrength(t, weight, params);
                if (unit === 'lb') strength *= 2.20462;
                xData.push(t);
                yData.push(strength);
            }

            const trace = {
                x: xData,
                y: yData,
                type: 'scatter',
                mode: 'lines+markers',
                name: getMovementName(movement)
            };

            const layout = {
                title: getChartTitle(weight, movement, gender),
                xaxis: { title: language === 'zh' ? '訓練時間（月）' : 'Training Time (Months)', range: [0, xMax] },
                yaxis: { title: language === 'zh' ? '絕對力量 (' + unit + ')' : 'Absolute Strength (' + unit + ')', range: [0, yMax] },
                shapes: [
                    { type: 'line', x0: 6, y0: 0, x1: 6, y1: yMax, line: { color: 'red', dash: 'dot' } },
                    { type: 'line', x0: 12, y0: 0, x1: 12, y1: yMax, line: { color: 'red', dash: 'dot' } },
                    { type: 'line', x0: 24, y0: 0, x1: 24, y1: yMax, line: { color: 'red', dash: 'dot' } },
                    { type: 'line', x0: 48, y0: 0, x1: 48, y1: yMax, line: { color: 'red', dash: 'dot' } }
                ],
                annotations: [
                    { x: 6, y: 0, text: language === 'zh' ? '新手' : 'Beginner', showarrow: false, font: { color: 'red' }, yshift: -20 },
                    { x: 12, y: 0, text: language === 'zh' ? '中級' : 'Novice', showarrow: false, font: { color: 'red' }, yshift: -20 },
                    { x: 24, y: 0, text: language === 'zh' ? '高級' : 'Intermediate', showarrow: false, font: { color: 'red' }, yshift: -20 },
                    { x: 48, y: 0, text: language === 'zh' ? '精英' : 'Elite', showarrow: false, font: { color: 'red' }, yshift: -20 }
                ]
            };

            Plotly.newPlot('chart', [trace], layout);
        }

        function getChartTitle(weight, movement, gender) {
            let genderText = (language === 'zh') ? (gender === 'male' ? '男性' : '女性') : (gender === 'male' ? 'Male' : 'Female');
            let movementName = getMovementName(movement);
            let weightDisplay = unit === 'lb' ? (weight * 2.20462).toFixed(0) + ' lb' : weight + ' kg';
            return language === 'zh' ?
                '體重 ' + weightDisplay + ' 的 ' + movementName + ' 力量成長曲線 (' + genderText + ')' :
                movementName + ' Strength Progression (' + genderText + ', ' + weightDisplay + ')';
        }

        function getMovementName(movement) {
            const names = {
                'Press': language === 'zh' ? '肩推 (Press)' : 'Press',
                'Bench Press': language === 'zh' ? '臥推 (Bench Press)' : 'Bench Press',
                'Squat': language === 'zh' ? '深蹲 (Squat)' : 'Squat',
                'Deadlift': language === 'zh' ? '硬舉 (Deadlift)' : 'Deadlift',
                'Power Clean': language === 'zh' ? '抓舉 (Power Clean)' : 'Power Clean'
            };
            return names[movement];
        }

        setDefaultWeight();
        updateChart();
    </script>

</body>

</html>