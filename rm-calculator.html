<!doctype html>
<html lang="zh-Hant">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>RM é€²åº¦æ¨è–¦å™¨</title>
    <style>
        :root {
            --bg: #f6f7f9;
            --card: #fff;
            --line: #e5e7eb;
            --txt: #111827;
            --muted: #6b7280;
        }

        body {
            margin: 0;
            background: var(--bg);
            font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial
        }

        .wrap {
            max-width: 1000px;
            margin: 40px auto;
            padding: 0 16px
        }

        .h1 {
            font-size: 26px;
            font-weight: 800;
            margin: 0 0 6px
        }

        .p {
            color: var(--muted);
            margin: 0 0 20px
        }

        .grid {
            display: grid;
            gap: 16px
        }

        @media(min-width:1024px) {
            .grid {
                grid-template-columns: 1fr 1fr
            }
        }

        .card {
            background: var(--card);
            border: 1px solid var(--line);
            border-radius: 14px;
            padding: 18px
        }

        label {
            display: block;
            font-size: 13px;
            color: #374151;
            margin: 8px 0 6px
        }

        input,
        select {
            width: 100%;
            padding: 8px 10px;
            border: 1px solid var(--line);
            border-radius: 10px;
            font-size: 15px
        }

        .row {
            display: flex;
            gap: 8px;
            align-items: center;
            margin: 8px 0;
            flex-wrap: wrap
        }

        .btn {
            padding: 5px 10px;
            border-radius: 999px;
            border: 1px solid var(--line);
            background: #fff;
            cursor: pointer
        }

        .btn.on {
            background: #111827;
            color: #fff
        }

        .stat {
            border: 1px solid var(--line);
            border-radius: 10px;
            padding: 12px
        }

        .stat .t {
            font-size: 12px;
            color: var(--muted)
        }

        .stat .v {
            font-size: 22px;
            font-weight: 700
        }

        .warn {
            background: #FFFBEB;
            color: #92400E;
            border: 1px solid #FDE68A;
            padding: 8px 10px;
            border-radius: 8px;
            margin-bottom: 10px;
            font-size: 13px
        }

        .list {
            font-size: 14px;
            color: #374151
        }

        .list li {
            margin: 4px 0
        }

        .info {
            margin-top: 24px;
            background: #fff;
            border: 1px solid var(--line);
            border-radius: 14px;
            padding: 16px
        }

        .info h3 {
            margin: 0 0 10px;
            font-size: 18px
        }

        .info table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px
        }

        .info th,
        .info td {
            border: 1px solid #e5e7eb;
            padding: 6px;
            text-align: left
        }

        .info th {
            background: #f3f4f6
        }

        .muted {
            color: #6b7280
        }

        .badge {
            font-size: 12px;
            padding: 2px 6px;
            border-radius: 999px;
            border: 1px solid var(--line);
            background: #fff
        }

        /* â¬‡ æ–°å¢ï¼šçµæœè¡¨æ ¼æ¨£å¼ */
        .rm-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
            margin-top: 8px
        }

        .rm-table th,
        .rm-table td {
            border: 1px solid #e5e7eb;
            padding: 6px;
            text-align: right
        }

        .rm-table th:first-child,
        .rm-table td:first-child {
            text-align: left
        }
    </style>
</head>

<body>
    <div class="wrap">
        <h1 class="h1">RM é€²åº¦æ¨è–¦å™¨ï¼ˆç¶­æŒ <span id="hdrTarget">5</span> æ¬¡çš„é‡é‡ï¼‰</h1>
        <p class="p">å°æ–¼æ·±è¹²ï¼Œå¯é¸æ“‡æ˜¯å¦å°‡ã€Œè‡ªé‡çš„ä¸€éƒ¨åˆ†ã€ç´å…¥è¨ˆç®—ï¼š<span class="badge">åªç®—æ§“éˆ´</span> æˆ– <span class="badge">æ§“éˆ´ + è‡ªé‡æ¯”ä¾‹</span>ã€‚</p>

        <div class="grid">
            <!-- å·¦é‚Šï¼šè¼¸å…¥ -->
            <div class="card">
                <h2 style="margin:0 0 12px;font-size:18px">è¼¸å…¥</h2>

                <label>å–®ä½ Unit</label>
                <div class="row">
                    <button class="btn on" id="btnKg">KG</button>
                    <button class="btn" id="btnLb">LB</button>
                </div>

                <label>è¨ˆç®—è² è·æ¨¡å¼</label>
                <div class="row">
                    <button class="btn on" id="modeBarOnly">åªç®—æ§“éˆ´</button>
                    <button class="btn" id="modeIncludeBW">æ§“éˆ´ + è‡ªé‡æ¯”ä¾‹</button>
                </div>

                <div class="row">
                    <div style="flex:1 1 180px;min-width:220px">
                        <label>å·¥ä½œé‡é‡ï¼ˆæ§“éˆ´ï¼‰</label>
                        <input id="weight" placeholder="ä¾‹å¦‚ 100" />
                    </div>
                    <div style="flex:1 1 120px;min-width:160px">
                        <label>æœ¬æ¬¡å®Œæˆæ¬¡æ•¸</label>
                        <input id="achieved" placeholder="ä¾‹å¦‚ 5" />
                    </div>
                    <div style="flex:1 1 120px;min-width:160px">
                        <label>ç›®æ¨™ç¶­æŒæ¬¡æ•¸</label>
                        <input id="target" value="5" />
                    </div>
                </div>

                <label>1RM å…¬å¼</label>
                <select id="formula">
                    <option value="epley">Epley</option>
                    <option value="brzycki">Brzycki</option>
                    <option value="lombardi">Lombardi</option>
                    <option value="oconner">Oâ€™Conner</option>
                    <option value="wathan">Wathan</option>
                </select>

                <div id="bwBlock" style="display:none">
                    <div class="row" style="margin-top:8px">
                        <div style="flex:1 1 200px;min-width:200px">
                            <label>è‡ªé‡ Bodyweight</label>
                            <input id="bodyweight" placeholder="ä¾‹å¦‚ 70" />
                        </div>
                        <div style="flex:1 1 200px;min-width:220px">
                            <label>è‡ªé‡ç´å…¥æ¯”ä¾‹ï¼ˆ0â€“100%ï¼‰</label>
                            <input id="bwRatio" value="75" />
                        </div>
                    </div>
                    <div class="row">
                        <span class="muted" style="font-size:12px">å¿«é€Ÿé¸æ“‡ï¼š</span>
                        <button class="btn" data-ratio="70">70%</button>
                        <button class="btn" data-ratio="75">75%</button>
                        <button class="btn" data-ratio="80">80%</button>
                        <span class="muted" style="font-size:12px">ï¼ˆé«˜æ§“/ä½æ§“/å‰è¹²å¯ä¾æ„Ÿè¦ºèª¿æ•´ï¼‰</span>
                    </div>
                </div>

                <label>å™¨æåˆ»åº¦ï¼ˆæœ€å°å¢é‡ï¼‰</label>
                <input id="step" value="2.5" />

                <label>æœ€å°å¢é‡ç­–ç•¥ï¼ˆç•¶å¢å¹…å¤ªå°æ™‚è‡³å°‘åŠ ï¼‰</label>
                <input id="minbump" value="2.5" />
            </div>

            <!-- å³é‚Šï¼šçµæœ -->
            <div class="card">
                <h2 style="margin:0 0 12px;font-size:18px">çµæœ</h2>
                <div id="warn" class="warn" style="display:none">æé†’ï¼šæ¬¡æ•¸ > 12 æ™‚ï¼Œ1RM æ¨ä¼°æº–ç¢ºåº¦ä¸‹é™ã€‚</div>

                <div class="grid" style="grid-template-columns:1fr 1fr;gap:12px;margin-bottom:12px">
                    <div class="stat">
                        <div class="t">æ¨ä¼° 1RMï¼ˆç­‰æ•ˆè¼‰é‡ï¼‰</div>
                        <div class="v" id="v1rm">-</div>
                    </div>
                    <div class="stat">
                        <div class="t">å»ºè­°æ§“éˆ´é‡é‡ï¼ˆå›åˆ°ç›®æ¨™æ¬¡æ•¸ï¼‰</div>
                        <div class="v" id="vrecBar">-</div>
                    </div>
                </div>

                <ul class="list">
                    <li>æ•¸å­¸å»ºè­°ï¼ˆç­‰æ•ˆç¸½è² è·ï¼‰: <span id="rawEff">-</span></li>
                    <li>ä¾åˆ»åº¦å››æ¨äº”å…¥ï¼ˆè½‰å›ç­‰æ•ˆï¼‰: <span id="roundedEff">-</span></li>
                    <li>è½‰æ›ç‚ºæ§“éˆ´é‡é‡: <span id="roundedBar">-</span></li>
                    <li>æœ€å°å¢é‡ç­–ç•¥: è‡³å°‘åŠ  <span id="min">2.5</span></li>
                </ul>
                <p id="negNote" class="muted" style="display:none;font-size:12px">â€» æ³¨æ„ï¼šåŒ…å«è‡ªé‡æ¯”ä¾‹æ™‚ï¼Œè‹¥è¨ˆç®—å°è‡´æ§“éˆ´é‡é‡ä½æ–¼ 0ï¼Œå°‡ä»¥ 0 è™•ç†ã€‚
                </p>

                <!-- â¬‡ æ–°å¢ï¼šRM å°ç…§è¡¨ -->
                <div class="info" style="margin-top:16px">
                    <h3 style="margin-top:0">RM å°ç…§è¡¨ï¼ˆä¾ç›®å‰è¨­å®šèˆ‡å…¬å¼ï¼‰</h3>
                    <div class="row" style="margin:6px 0">
                        <label style="margin:0">é¡¯ç¤ºåˆ°å¹¾ RMï¼š
                            <input id="maxRM" value="12" inputmode="numeric"
                                style="width:90px;display:inline-block;margin-left:8px">
                        </label>
                    </div>
                    <table class="rm-table">
                        <thead>
                            <tr>
                                <th>æ¬¡æ•¸ (RM)</th>
                                <th>ç­‰æ•ˆç¸½è² è·</th>
                                <th>æ§“éˆ´é‡é‡ï¼ˆå››æ¨äº”å…¥ï¼‰</th>
                                <th>%1RM</th>
                            </tr>
                        </thead>
                        <tbody id="rmTableBody">
                            <tr>
                                <td colspan="4" class="muted">è«‹å…ˆè¼¸å…¥é‡é‡èˆ‡æ¬¡æ•¸</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <!-- â†‘ æ–°å¢çµæŸ -->
            </div>
        </div>

        <!-- å…¬å¼æ¯”è¼ƒèˆ‡é©ç”¨ç¯„åœ -->
        <div class="info">
            <h3>å…¬å¼æ¯”è¼ƒèˆ‡é©ç”¨ç¯„åœ</h3>
            <table>
                <tr>
                    <th>å…¬å¼</th>
                    <th>ç‰¹é»</th>
                    <th>é©ç”¨ç¯„åœ</th>
                </tr>
                <tr>
                    <td>Epley</td>
                    <td>æœ€å¸¸ç”¨ï¼Œè¨ˆç®—ç°¡å–®</td>
                    <td>ä¸€èˆ¬ 1â€“10 æ¬¡æ•¸ç¯„åœï¼Œè¨“ç·´æ‡‰ç”¨å»£</td>
                </tr>
                <tr>
                    <td>Brzycki</td>
                    <td>å°é«˜æ¬¡æ•¸è¼ƒæ•æ„Ÿ</td>
                    <td>å»ºè­° 1â€“10 RMï¼Œ>10 æ¬¡æº–ç¢ºåº¦ä¸‹é™</td>
                </tr>
                <tr>
                    <td>Lombardi</td>
                    <td>ç”¨æ¬¡æ•¸çš„æŒ‡æ•¸ä¿®æ­£</td>
                    <td>ä¸­é«˜æ¬¡æ•¸ï¼ˆ8â€“12 RMï¼‰è¼ƒç©©å®š</td>
                </tr>
                <tr>
                    <td>Oâ€™Conner</td>
                    <td>æ¯æ¬¡ +2.5% çš„ç·šæ€§ä¼°ç®—</td>
                    <td>å…¥é–€è€…æˆ–ä¸­ç­‰å¼·åº¦ä¼°ç®—</td>
                </tr>
                <tr>
                    <td>Wathan</td>
                    <td>è¼ƒè¤‡é›œçš„å›æ­¸å¼</td>
                    <td>ç ”ç©¶/é«˜æº–ç¢ºåº¦éœ€æ±‚</td>
                </tr>
            </table>
            <p class="muted" style="margin-top:10px;font-size:13px">
                ğŸ’¡ ä¸€èˆ¬è¨“ç·´å…ˆç”¨ã€Œåªç®—æ§“éˆ´ã€ï¼›è‹¥æƒ³æ›´è²¼è¿‘ä¸‹è‚¢æ‰¿è¼‰ï¼Œå¯åˆ‡ã€Œæ§“éˆ´ + è‡ªé‡æ¯”ä¾‹ã€ã€‚æ¯”ä¾‹å¸¸ç”¨ 70â€“80%ï¼Œè¦–å‹•ä½œå‹æ…‹ï¼ˆé«˜æ§“ã€ä½æ§“ã€å‰è¹²ï¼‰èˆ‡æ·±åº¦/å§¿å‹¢èª¿æ•´ã€‚
            </p>
        </div>
    </div>

    <script>
        // å–®ä½è½‰æ›
        const LB_TO_KG = 0.45359237, KG_TO_LB = 1 / LB_TO_KG;
        let unit = 'kg';
        let includeBW = false;

        const qs = id => document.getElementById(id);
        const toKg = v => unit === 'lb' ? v * LB_TO_KG : v;
        const fromKg = v => unit === 'lb' ? v * KG_TO_LB : v;
        const roundToStep = (v, s) => Math.round(v / s) * s;
        const fmt = v => !isFinite(v) ? '-' : (unit === 'kg' ? Number(v).toFixed(1) : Math.round(Number(v)));
        const clamp = (v, lo, hi) => Math.min(Math.max(v, lo), hi);

        // å…¬å¼
        const fwd = {
            epley: (W, r) => W * (1 + r / 30),
            brzycki: (W, r) => W / (1.0278 - 0.0278 * r),
            lombardi: (W, r) => W * Math.pow(r, 0.1),
            oconner: (W, r) => W * (1 + 0.025 * r),
            wathan: (W, r) => (100 * W) / (48.8 + 53.8 * Math.exp(-0.075 * r)),
        };
        const inv = {
            epley: (o, r) => o / (1 + r / 30),
            brzycki: (o, r) => o * (1.0278 - 0.0278 * r),
            lombardi: (o, r) => o / Math.pow(r, 0.1),
            oconner: (o, r) => o / (1 + 0.025 * r),
            wathan: (o, r) => (o * (48.8 + 53.8 * Math.exp(-0.075 * r))) / 100,
        };

        // å…ƒç´ 
        const elW = qs('weight'), elR = qs('achieved'), elRt = qs('target'),
            elF = qs('formula'), elS = qs('step'), elM = qs('minbump'),
            v1 = qs('v1rm'), vrecBar = qs('vrecBar'),
            vrawEff = qs('rawEff'), vroundedEff = qs('roundedEff'), vroundedBar = qs('roundedBar'),
            vmin = qs('min'), warn = qs('warn'), hdr = qs('hdrTarget'),
            btnKg = qs('btnKg'), btnLb = qs('btnLb'),
            modeBarOnly = qs('modeBarOnly'), modeIncludeBW = qs('modeIncludeBW'),
            bwBlock = qs('bwBlock'), elBW = qs('bodyweight'), elRatio = qs('bwRatio'),
            negNote = qs('negNote'),
            rmBody = qs('rmTableBody'), elMaxRM = qs('maxRM'); // â¬… æ–°å¢

        // è‡ªé‡æ¯”ä¾‹å¿«é€Ÿéµ
        document.querySelectorAll('[data-ratio]').forEach(btn => {
            btn.addEventListener('click', () => { elRatio.value = btn.getAttribute('data-ratio'); recalc(); });
        });

        function recalc() {
            const Wbar = Number(elW.value);
            const r = Math.floor(Number(elR.value));
            const rt = Math.floor(Number(elRt.value));
            const step = Number(elS.value) || 0;
            const minBump = Number(elM.value) || 0;
            const BW = Number(elBW?.value || 0);
            const ratioPct = clamp(Number(elRatio?.value || 0), 0, 100);
            const ratio = ratioPct / 100;

            hdr.textContent = rt || 5;
            vmin.textContent = isFinite(minBump) ? minBump : '-';
            warn.style.display = r > 12 ? 'block' : 'none';

            const needBW = includeBW;
            const baseValid = (Wbar > 0 && r >= 1 && rt >= 1);
            const bwValid = (!needBW) || (BW > 0 && ratio >= 0);

            // å…ˆæ¸…ç©ºè¡¨æ ¼
            if (rmBody) rmBody.innerHTML = '<tr><td colspan="4" class="muted">è«‹å…ˆè¼¸å…¥é‡é‡èˆ‡æ¬¡æ•¸</td></tr>';

            if (!baseValid || !bwValid) {
                [v1, vrecBar, vrawEff, vroundedEff, vroundedBar].forEach(el => el.textContent = '-');
                negNote.style.display = 'none';
                return;
            }

            // ç­‰æ•ˆç¸½è² è·
            const WbarKg = toKg(Wbar);
            const BWkg = toKg(BW);
            const added = includeBW ? (BWkg * ratio) : 0;
            const W_eff_kg = WbarKg + added;

            const f = elF.value;
            const oneRM_eff_kg = fwd[f](W_eff_kg, r);
            const oneRM_eff = fromKg(oneRM_eff_kg);

            const target_eff_kg = inv[f](oneRM_eff_kg, rt);
            const target_eff = fromKg(target_eff_kg);

            let target_bar = includeBW ? (target_eff - fromKg(BWkg * ratio)) : target_eff;
            if (target_bar < 0) target_bar = 0;

            const rounded_bar = roundToStep(target_bar, step);
            const rounded_eff = includeBW ? (rounded_bar + fromKg(BWkg * ratio)) : rounded_bar;

            const deltaRawBar = target_bar - Wbar;
            const deltaRoundedBar = rounded_bar - Wbar;
            const sensible_bar = (deltaRoundedBar <= 0 && deltaRawBar > 0 && deltaRawBar < minBump)
                ? roundToStep(Wbar + minBump, step)
                : rounded_bar;

            v1.textContent = fmt(oneRM_eff);
            vrecBar.textContent = fmt(sensible_bar);
            vrawEff.textContent = fmt(target_eff);
            vroundedEff.textContent = fmt(rounded_eff);
            vroundedBar.textContent = fmt(rounded_bar);
            negNote.style.display = includeBW && target_bar === 0 ? 'block' : 'none';

            // â¬‡ ç”Ÿæˆ RM å°ç…§è¡¨
            const maxRM = Math.max(1, Math.min(20, Math.floor(Number(elMaxRM?.value || 12))));
            let rows = '';
            for (let rr = 1; rr <= maxRM; rr++) {
                const effKg = inv[f](oneRM_eff_kg, rr);          // è©² RM çš„ç­‰æ•ˆç¸½è² è· (kg)
                const eff = fromKg(effKg);                       // è½‰ç‚ºç•¶å‰å–®ä½é¡¯ç¤º
                let bar = includeBW ? (eff - fromKg(BWkg * ratio)) : eff;
                if (bar < 0) bar = 0;
                const barRounded = roundToStep(bar, step);
                const pct = (effKg / oneRM_eff_kg) * 100;        // è©² RM å  1RM çš„ç™¾åˆ†æ¯”

                rows += `<tr>
          <td>${rr}RM</td>
          <td>${fmt(eff)}</td>
          <td>${fmt(barRounded)}</td>
          <td>${pct.toFixed(0)}%</td>
        </tr>`;
            }
            rmBody.innerHTML = rows;
            // â†‘ ç”ŸæˆçµæŸ
        }

        // äº‹ä»¶
        [elW, elR, elRt, elF, elS, elM].forEach(el => el.addEventListener('input', recalc));
        [elBW, elRatio, elMaxRM].forEach(el => el && el.addEventListener('input', recalc));

        btnKg.onclick = () => {
            if (unit === 'kg') return;
            const convert = v => (Number(v) > 0 ? (Number(v) * LB_TO_KG) : v);
            elW.value = Number.isFinite(+elW.value) ? (convert(elW.value)).toFixed(2).replace(/\.00$/, '') : elW.value;
            if (elBW) elBW.value = Number.isFinite(+elBW.value) ? (convert(elBW.value)).toFixed(2).replace(/\.00$/, '') : elBW.value;
            elS.value = Number.isFinite(+elS.value) ? (convert(elS.value)).toFixed(2).replace(/\.00$/, '') : elS.value;
            elM.value = Number.isFinite(+elM.value) ? (convert(elM.value)).toFixed(2).replace(/\.00$/, '') : elM.value;
            unit = 'kg'; btnKg.classList.add('on'); btnLb.classList.remove('on'); recalc();
        };
        btnLb.onclick = () => {
            if (unit === 'lb') return;
            const convert = v => (Number(v) > 0 ? Math.round(Number(v) * KG_TO_LB) : v);
            elW.value = Number.isFinite(+elW.value) ? convert(elW.value) : elW.value;
            if (elBW) elBW.value = Number.isFinite(+elBW.value) ? convert(elBW.value) : elBW.value;
            elS.value = Number.isFinite(+elS.value) ? convert(elS.value) : elS.value;
            elM.value = Number.isFinite(+elM.value) ? convert(elM.value) : elM.value;
            unit = 'lb'; btnLb.classList.add('on'); btnKg.classList.remove('on'); recalc();
        };

        // æ¨¡å¼åˆ‡æ›
        modeBarOnly.onclick = () => {
            includeBW = false;
            modeBarOnly.classList.add('on'); modeIncludeBW.classList.remove('on');
            bwBlock.style.display = 'none';
            recalc();
        };
        modeIncludeBW.onclick = () => {
            includeBW = true;
            modeIncludeBW.classList.add('on'); modeBarOnly.classList.remove('on');
            bwBlock.style.display = 'block';
            recalc();
        };

        // åˆå§‹
        recalc();
    </script>
</body>

</html>